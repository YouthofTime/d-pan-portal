{"remainingRequest":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\src\\components\\user-info\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\src\\components\\user-info\\index.vue","mtime":1710063488156},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgdXNlclNlcnZpY2UgZnJvbSAnLi4vLi4vYXBpL3VzZXInCmltcG9ydCB7Y2xlYXJUb2tlbn0gZnJvbSAnLi4vLi4vdXRpbHMvY29va2llJwppbXBvcnQge21hcEdldHRlcnMsIG1hcE11dGF0aW9uc30gZnJvbSAndnVleCcKCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJQYW5Vc2VySW5mbyIsCiAgICBkYXRhKCkgewogICAgICAgIGxldCBjaGVja1JlTmV3UGFzc3dvcmQgPSAocnVsZSwgdmFsdWUsIGNhbGxiYWNrKSA9PiB7CiAgICAgICAgICAgIGlmICh2YWx1ZSAhPT0gdGhpcy5jaGFuZ2VQYXNzd29yZEZvcm0ubmV3UGFzc3dvcmQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjYWxsYmFjayhuZXcgRXJyb3IoJ+S4pOasoeWvhueggeS4jeS4gOiHtCcpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrKCkKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjaGFuZ2VQYXNzd29yZERpYWxvZ1Zpc2libGU6IGZhbHNlLAogICAgICAgICAgICBjaGFuZ2VQYXNzd29yZEZvcm06IHsKICAgICAgICAgICAgICAgIHBhc3N3b3JkOiAnJywKICAgICAgICAgICAgICAgIG5ld1Bhc3N3b3JkOiAnJywKICAgICAgICAgICAgICAgIHJlTmV3UGFzc3dvcmQ6ICcnCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICAgICAgICBjaGFuZ2VQYXNzd29yZFJ1bGVzOiB7CiAgICAgICAgICAgICAgICBwYXNzd29yZDogWwogICAgICAgICAgICAgICAgICAgIHtyZXF1aXJlZDogdHJ1ZSwgbWVzc2FnZTogJ+ivt+i+k+WFpeaXp+WvhueggScsIHRyaWdnZXI6ICdibHVyJ30sCiAgICAgICAgICAgICAgICAgICAge21pbjogOCwgbWF4OiAxNiwgbWVzc2FnZTogJ+ivt+i+k+WFpTgtMTbkvY3nmoTlr4bnoIEnLCB0cmlnZ2VyOiAnYmx1cid9CiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgbmV3UGFzc3dvcmQ6IFsKICAgICAgICAgICAgICAgICAgICB7cmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fovpPlhaXmlrDlr4bnoIEnLCB0cmlnZ2VyOiAnYmx1cid9LAogICAgICAgICAgICAgICAgICAgIHttaW46IDgsIG1heDogMTYsIG1lc3NhZ2U6ICfor7fovpPlhaU4LTE25L2N55qE5a+G56CBJywgdHJpZ2dlcjogJ2JsdXInfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgIHJlTmV3UGFzc3dvcmQ6IFsKICAgICAgICAgICAgICAgICAgICB7cmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fovpPlhaXnoa7orqTlr4bnoIEnLCB0cmlnZ2VyOiAnYmx1cid9LAogICAgICAgICAgICAgICAgICAgIHt2YWxpZGF0b3I6IGNoZWNrUmVOZXdQYXNzd29yZCwgdHJpZ2dlcjogJ2JsdXInfQogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICAuLi5tYXBNdXRhdGlvbnMoewogICAgICAgICAgICBjbGVhckZpbGU6ICdmaWxlL2NsZWFyJywKICAgICAgICAgICAgY2xlYXJCcmVhZENydW1iOiAnYnJlYWRjcnVtYi9jbGVhcicsCiAgICAgICAgICAgIGNsZWFyTmF2QmFyOiAnbmF2YmFyL2NsZWFyJywKICAgICAgICAgICAgY2xlYXJVc2VyOiAndXNlci9jbGVhcicsCiAgICAgICAgICAgIHNldFBhcmVudElkOiAnZmlsZS9zZXRGaWxlUGFyZW50SWQnLAogICAgICAgICAgICBzZXREZWZhdWx0UGFyZW50SWQ6ICdmaWxlL3NldEZpbGVEZWZhdWx0UGFyZW50SWQnLAogICAgICAgICAgICBzZXREZWZhdWx0UGFyZW50RmlsZW5hbWU6ICdmaWxlL3NldERlZmF1bHRQYXJlbnRGaWxlbmFtZScsCiAgICAgICAgICAgIHNldFVzZXJuYW1lOiAndXNlci9zZXRVc2VybmFtZScKICAgICAgICB9KSwKICAgICAgICBoYW5kbGVDb21tYW5kKGNvbW1hbmQpIHsKICAgICAgICAgICAgaWYgKGNvbW1hbmQgPT09ICdjaGFuZ2VQYXNzd29yZCcpIHsKICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlUGFzc3dvcmREaWFsb2dWaXNpYmxlID0gdHJ1ZQogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbW1hbmQgPT09ICdleGl0JykgewogICAgICAgICAgICAgICAgdGhpcy5leGl0KCkKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZG9DaGFuZ2VQYXNzd29yZCgpIHsKICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcwogICAgICAgICAgICBfdGhpcy4kcmVmcy5jaGFuZ2VQYXNzd29yZEZvcm0udmFsaWRhdGUoKHZhbGlkKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5sb2FkaW5nID0gdHJ1ZQogICAgICAgICAgICAgICAgICAgIHVzZXJTZXJ2aWNlLmNoYW5nZVBhc3N3b3JkKHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFzc3dvcmQ6IF90aGlzLmNoYW5nZVBhc3N3b3JkRm9ybS5wYXNzd29yZCwKICAgICAgICAgICAgICAgICAgICAgICAgbmV3UGFzc3dvcmQ6IF90aGlzLmNoYW5nZVBhc3N3b3JkRm9ybS5uZXdQYXNzd29yZAogICAgICAgICAgICAgICAgICAgIH0sICgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMubG9hZGluZyA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmNoYW5nZVBhc3N3b3JkRGlhbG9nVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLiRub3RpZnkoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGl0bGU6ICfmiJDlip8nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ+WvhueggeS/ruaUueaIkOWKnyzljbPlsIbot7Povazoh7PnmbvlvZXpobXpnaInLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gX3RoaXMuZ29Mb2dpbigpLCAxMDAwKQogICAgICAgICAgICAgICAgICAgIH0sIHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLiRtZXNzYWdlLmVycm9yKHJlcy5tZXNzYWdlKQogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5sb2FkaW5nID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgZXhpdCgpIHsKICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcwogICAgICAgICAgICBfdGhpcy4kY29uZmlybSgn56Gu5a6a6KaB6YCA5Ye655m75b2V5ZCXPycsICfmj5DnpLonLCB7CiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogJ+ehruWumicsCiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgICAgICAgICAgIHR5cGU6ICd3YXJuaW5nJwogICAgICAgICAgICB9KS50aGVuKCgpID0+IHsKICAgICAgICAgICAgICAgIHVzZXJTZXJ2aWNlLmV4aXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIF90aGlzLmdvTG9naW4oKQogICAgICAgICAgICAgICAgfSwgcmVzID0+IHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubWVzc2FnZSkKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICAgICAgZ29Mb2dpbigpIHsKICAgICAgICAgICAgY2xlYXJUb2tlbigpCiAgICAgICAgICAgIHRoaXMuY2xlYXJGaWxlKCkKICAgICAgICAgICAgdGhpcy5jbGVhckJyZWFkQ3J1bWIoKQogICAgICAgICAgICB0aGlzLmNsZWFyTmF2QmFyKCkKICAgICAgICAgICAgdGhpcy5jbGVhclVzZXIoKQogICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCkKICAgICAgICB9LAogICAgICAgIGZvY3VzUGFzc3dvcmRJbnB1dCgpIHsKICAgICAgICAgICAgdGhpcy4kcmVmcy5wYXNzd29yZC5mb2N1cygpCiAgICAgICAgfSwKICAgICAgICByZXNldENoYW5nZVBhc3N3b3JkRm9ybSgpIHsKICAgICAgICAgICAgdGhpcy4kcmVmcy5jaGFuZ2VQYXNzd29yZEZvcm0ucmVzZXRGaWVsZHMoKQogICAgICAgIH0sCiAgICAgICAgaW5pdFVzZXJJbmZvSWZOZWNlc3NhcnkoKSB7CiAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMKICAgICAgICAgICAgaWYgKCFfdGhpcy51c2VybmFtZSkgewogICAgICAgICAgICAgICAgdXNlclNlcnZpY2UuaW5mbyhyZXMgPT4gewogICAgICAgICAgICAgICAgICAgIF90aGlzLnNldFBhcmVudElkKHJlcy5kYXRhLnJvb3RGaWxlSWQpCiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0RGVmYXVsdFBhcmVudElkKHJlcy5kYXRhLnJvb3RGaWxlSWQpCiAgICAgICAgICAgICAgICAgICAgX3RoaXMuc2V0RGVmYXVsdFBhcmVudEZpbGVuYW1lKHJlcy5kYXRhLnJvb3RGaWxlbmFtZSkKICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXRVc2VybmFtZShyZXMuZGF0YS51c2VybmFtZSkKICAgICAgICAgICAgICAgIH0sIHJlcyA9PiB7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLm1lc3NhZ2UpCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSwKICAgIGNvbXB1dGVkOiB7CiAgICAgICAgLi4ubWFwR2V0dGVycyhbJ3VzZXJuYW1lJ10pCiAgICB9LAogICAgbW91bnRlZCgpIHsKICAgICAgICB0aGlzLmluaXRVc2VySW5mb0lmTmVjZXNzYXJ5KCkKICAgIH0sCiAgICB3YXRjaDoge30KfQoK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyDA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/user-info","sourcesContent":["<template>\n    <div>\n        <el-dropdown @command=\"handleCommand\">\n                          <span class=\"pan-user-info\">\n                            欢迎您,{{ username }}\n                              <i class=\"el-icon-arrow-down el-icon--right\"/>\n                          </span>\n            <el-dropdown-menu slot=\"dropdown\">\n                <el-dropdown-item command=\"changePassword\">修改密码</el-dropdown-item>\n                <el-dropdown-item command=\"exit\">退出登录</el-dropdown-item>\n            </el-dropdown-menu>\n        </el-dropdown>\n        <el-dialog\n                title=\"修改密码\"\n                :visible.sync=\"changePasswordDialogVisible\"\n                @opened=\"focusPasswordInput\"\n                @closed=\"resetChangePasswordForm\"\n                width=\"30%\"\n                :append-to-body=true\n                :modal-append-to-body=false\n                :center=true>\n            <div>\n                <el-form label-width=\"100px\" :rules=\"changePasswordRules\" ref=\"changePasswordForm\"\n                         :model=\"changePasswordForm\"\n                         status-icon\n                         @submit.native.prevent>\n                    <el-form-item label=\"旧密码\" prop=\"password\">\n                        <el-input type=\"password\"\n                                  show-password\n                                  ref=\"password\"\n                                  @keyup.enter.native=\"doChangePassword\"\n                                  v-model=\"changePasswordForm.password\" autocomplete=\"off\"/>\n                    </el-form-item>\n                    <el-form-item label=\"新密码\" prop=\"newPassword\">\n                        <el-input type=\"password\"\n                                  show-password\n                                  @keyup.enter.native=\"doChangePassword\"\n                                  v-model=\"changePasswordForm.newPassword\" autocomplete=\"off\"/>\n                    </el-form-item>\n                    <el-form-item label=\"确认密码\" prop=\"reNewPassword\">\n                        <el-input type=\"password\"\n                                  show-password\n                                  @keyup.enter.native=\"doChangePassword\"\n                                  v-model=\"changePasswordForm.reNewPassword\" autocomplete=\"off\"/>\n                    </el-form-item>\n                </el-form>\n            </div>\n            <span slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"changePasswordDialogVisible = false\">取 消</el-button>\n                <el-button type=\"primary\" @click=\"doChangePassword\" :loading=\"loading\">确 定</el-button>\n            </span>\n        </el-dialog>\n    </div>\n</template>\n\n<script>\n\n    import userService from '../../api/user'\n    import {clearToken} from '../../utils/cookie'\n    import {mapGetters, mapMutations} from 'vuex'\n\n    export default {\n        name: \"PanUserInfo\",\n        data() {\n            let checkReNewPassword = (rule, value, callback) => {\n                if (value !== this.changePasswordForm.newPassword) {\n                    return callback(new Error('两次密码不一致'));\n                } else {\n                    callback()\n                }\n            }\n            return {\n                changePasswordDialogVisible: false,\n                changePasswordForm: {\n                    password: '',\n                    newPassword: '',\n                    reNewPassword: ''\n                },\n                loading: false,\n                changePasswordRules: {\n                    password: [\n                        {required: true, message: '请输入旧密码', trigger: 'blur'},\n                        {min: 8, max: 16, message: '请输入8-16位的密码', trigger: 'blur'}\n                    ],\n                    newPassword: [\n                        {required: true, message: '请输入新密码', trigger: 'blur'},\n                        {min: 8, max: 16, message: '请输入8-16位的密码', trigger: 'blur'}\n                    ],\n                    reNewPassword: [\n                        {required: true, message: '请输入确认密码', trigger: 'blur'},\n                        {validator: checkReNewPassword, trigger: 'blur'}\n                    ]\n                }\n            }\n        },\n        methods: {\n            ...mapMutations({\n                clearFile: 'file/clear',\n                clearBreadCrumb: 'breadcrumb/clear',\n                clearNavBar: 'navbar/clear',\n                clearUser: 'user/clear',\n                setParentId: 'file/setFileParentId',\n                setDefaultParentId: 'file/setFileDefaultParentId',\n                setDefaultParentFilename: 'file/setDefaultParentFilename',\n                setUsername: 'user/setUsername'\n            }),\n            handleCommand(command) {\n                if (command === 'changePassword') {\n                    this.changePasswordDialogVisible = true\n                } else if (command === 'exit') {\n                    this.exit()\n                }\n            },\n            doChangePassword() {\n                let _this = this\n                _this.$refs.changePasswordForm.validate((valid) => {\n                    if (valid) {\n                        _this.loading = true\n                        userService.changePassword({\n                            password: _this.changePasswordForm.password,\n                            newPassword: _this.changePasswordForm.newPassword\n                        }, () => {\n                            _this.loading = false\n                            _this.changePasswordDialogVisible = false\n                            _this.$notify({\n                                title: '成功',\n                                message: '密码修改成功,即将跳转至登录页面',\n                                type: 'success'\n                            })\n                            setTimeout(() => _this.goLogin(), 1000)\n                        }, res => {\n                            _this.$message.error(res.message)\n                            _this.loading = false\n                        })\n                    }\n                })\n            },\n            exit() {\n                let _this = this\n                _this.$confirm('确定要退出登录吗?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                }).then(() => {\n                    userService.exit(() => {\n                        _this.goLogin()\n                    }, res => {\n                        _this.$message.error(res.message)\n                    })\n\n                })\n            },\n            goLogin() {\n                clearToken()\n                this.clearFile()\n                this.clearBreadCrumb()\n                this.clearNavBar()\n                this.clearUser()\n                window.location.reload()\n            },\n            focusPasswordInput() {\n                this.$refs.password.focus()\n            },\n            resetChangePasswordForm() {\n                this.$refs.changePasswordForm.resetFields()\n            },\n            initUserInfoIfNecessary() {\n                let _this = this\n                if (!_this.username) {\n                    userService.info(res => {\n                        _this.setParentId(res.data.rootFileId)\n                        _this.setDefaultParentId(res.data.rootFileId)\n                        _this.setDefaultParentFilename(res.data.rootFilename)\n                        _this.setUsername(res.data.username)\n                    }, res => {\n                        _this.$message.error(res.message)\n                    })\n                }\n            }\n        },\n        computed: {\n            ...mapGetters(['username'])\n        },\n        mounted() {\n            this.initUserInfoIfNecessary()\n        },\n        watch: {}\n    }\n\n</script>\n\n<style scoped>\n    .pan-user-info {\n        color: #409EFF;\n    }\n</style>"]}]}