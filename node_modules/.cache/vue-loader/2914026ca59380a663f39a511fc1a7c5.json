{"remainingRequest":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\src\\components\\user-info\\index.vue?vue&type=style&index=0&id=7389ec13&scoped=true&lang=css&","dependencies":[{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\src\\components\\user-info\\index.vue","mtime":1710063488156},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLnBhbi11c2VyLWluZm8gewogICAgY29sb3I6ICM0MDlFRkY7Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgMA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/user-info","sourcesContent":["<template>\n    <div>\n        <el-dropdown @command=\"handleCommand\">\n                          <span class=\"pan-user-info\">\n                            欢迎您,{{ username }}\n                              <i class=\"el-icon-arrow-down el-icon--right\"/>\n                          </span>\n            <el-dropdown-menu slot=\"dropdown\">\n                <el-dropdown-item command=\"changePassword\">修改密码</el-dropdown-item>\n                <el-dropdown-item command=\"exit\">退出登录</el-dropdown-item>\n            </el-dropdown-menu>\n        </el-dropdown>\n        <el-dialog\n                title=\"修改密码\"\n                :visible.sync=\"changePasswordDialogVisible\"\n                @opened=\"focusPasswordInput\"\n                @closed=\"resetChangePasswordForm\"\n                width=\"30%\"\n                :append-to-body=true\n                :modal-append-to-body=false\n                :center=true>\n            <div>\n                <el-form label-width=\"100px\" :rules=\"changePasswordRules\" ref=\"changePasswordForm\"\n                         :model=\"changePasswordForm\"\n                         status-icon\n                         @submit.native.prevent>\n                    <el-form-item label=\"旧密码\" prop=\"password\">\n                        <el-input type=\"password\"\n                                  show-password\n                                  ref=\"password\"\n                                  @keyup.enter.native=\"doChangePassword\"\n                                  v-model=\"changePasswordForm.password\" autocomplete=\"off\"/>\n                    </el-form-item>\n                    <el-form-item label=\"新密码\" prop=\"newPassword\">\n                        <el-input type=\"password\"\n                                  show-password\n                                  @keyup.enter.native=\"doChangePassword\"\n                                  v-model=\"changePasswordForm.newPassword\" autocomplete=\"off\"/>\n                    </el-form-item>\n                    <el-form-item label=\"确认密码\" prop=\"reNewPassword\">\n                        <el-input type=\"password\"\n                                  show-password\n                                  @keyup.enter.native=\"doChangePassword\"\n                                  v-model=\"changePasswordForm.reNewPassword\" autocomplete=\"off\"/>\n                    </el-form-item>\n                </el-form>\n            </div>\n            <span slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"changePasswordDialogVisible = false\">取 消</el-button>\n                <el-button type=\"primary\" @click=\"doChangePassword\" :loading=\"loading\">确 定</el-button>\n            </span>\n        </el-dialog>\n    </div>\n</template>\n\n<script>\n\n    import userService from '../../api/user'\n    import {clearToken} from '../../utils/cookie'\n    import {mapGetters, mapMutations} from 'vuex'\n\n    export default {\n        name: \"PanUserInfo\",\n        data() {\n            let checkReNewPassword = (rule, value, callback) => {\n                if (value !== this.changePasswordForm.newPassword) {\n                    return callback(new Error('两次密码不一致'));\n                } else {\n                    callback()\n                }\n            }\n            return {\n                changePasswordDialogVisible: false,\n                changePasswordForm: {\n                    password: '',\n                    newPassword: '',\n                    reNewPassword: ''\n                },\n                loading: false,\n                changePasswordRules: {\n                    password: [\n                        {required: true, message: '请输入旧密码', trigger: 'blur'},\n                        {min: 8, max: 16, message: '请输入8-16位的密码', trigger: 'blur'}\n                    ],\n                    newPassword: [\n                        {required: true, message: '请输入新密码', trigger: 'blur'},\n                        {min: 8, max: 16, message: '请输入8-16位的密码', trigger: 'blur'}\n                    ],\n                    reNewPassword: [\n                        {required: true, message: '请输入确认密码', trigger: 'blur'},\n                        {validator: checkReNewPassword, trigger: 'blur'}\n                    ]\n                }\n            }\n        },\n        methods: {\n            ...mapMutations({\n                clearFile: 'file/clear',\n                clearBreadCrumb: 'breadcrumb/clear',\n                clearNavBar: 'navbar/clear',\n                clearUser: 'user/clear',\n                setParentId: 'file/setFileParentId',\n                setDefaultParentId: 'file/setFileDefaultParentId',\n                setDefaultParentFilename: 'file/setDefaultParentFilename',\n                setUsername: 'user/setUsername'\n            }),\n            handleCommand(command) {\n                if (command === 'changePassword') {\n                    this.changePasswordDialogVisible = true\n                } else if (command === 'exit') {\n                    this.exit()\n                }\n            },\n            doChangePassword() {\n                let _this = this\n                _this.$refs.changePasswordForm.validate((valid) => {\n                    if (valid) {\n                        _this.loading = true\n                        userService.changePassword({\n                            password: _this.changePasswordForm.password,\n                            newPassword: _this.changePasswordForm.newPassword\n                        }, () => {\n                            _this.loading = false\n                            _this.changePasswordDialogVisible = false\n                            _this.$notify({\n                                title: '成功',\n                                message: '密码修改成功,即将跳转至登录页面',\n                                type: 'success'\n                            })\n                            setTimeout(() => _this.goLogin(), 1000)\n                        }, res => {\n                            _this.$message.error(res.message)\n                            _this.loading = false\n                        })\n                    }\n                })\n            },\n            exit() {\n                let _this = this\n                _this.$confirm('确定要退出登录吗?', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                }).then(() => {\n                    userService.exit(() => {\n                        _this.goLogin()\n                    }, res => {\n                        _this.$message.error(res.message)\n                    })\n\n                })\n            },\n            goLogin() {\n                clearToken()\n                this.clearFile()\n                this.clearBreadCrumb()\n                this.clearNavBar()\n                this.clearUser()\n                window.location.reload()\n            },\n            focusPasswordInput() {\n                this.$refs.password.focus()\n            },\n            resetChangePasswordForm() {\n                this.$refs.changePasswordForm.resetFields()\n            },\n            initUserInfoIfNecessary() {\n                let _this = this\n                if (!_this.username) {\n                    userService.info(res => {\n                        _this.setParentId(res.data.rootFileId)\n                        _this.setDefaultParentId(res.data.rootFileId)\n                        _this.setDefaultParentFilename(res.data.rootFilename)\n                        _this.setUsername(res.data.username)\n                    }, res => {\n                        _this.$message.error(res.message)\n                    })\n                }\n            }\n        },\n        computed: {\n            ...mapGetters(['username'])\n        },\n        mounted() {\n            this.initUserInfoIfNecessary()\n        },\n        watch: {}\n    }\n\n</script>\n\n<style scoped>\n    .pan-user-info {\n        color: #409EFF;\n    }\n</style>"]}]}