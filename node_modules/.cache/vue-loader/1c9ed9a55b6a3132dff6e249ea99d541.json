{"remainingRequest":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\src\\components\\buttons\\download-button\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\src\\components\\buttons\\download-button\\index.vue","mtime":1710063487650},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgcGFuVXRpbCBmcm9tICcuLi8uLi8uLi91dGlscy9jb21tb24nCmltcG9ydCB7IGdldFRva2VuIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvY29va2llJwppbXBvcnQgeyBtYXBHZXR0ZXJzIH0gZnJvbSAndnVleCcKCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICdEb3duTG9hZEJ1dHRvbicsCiAgICBjb21wb25lbnRzOiB7fSwKICAgIHByb3BzOiB7CiAgICAgICAgcm91bmRGbGFnOiBCb29sZWFuLAogICAgICAgIGNpcmNsZUZsYWc6IEJvb2xlYW4sCiAgICAgICAgc2l6ZTogU3RyaW5nLAogICAgICAgIGl0ZW06IE9iamVjdAogICAgfSwKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgbG9hZGluZzogZmFsc2UKICAgICAgICB9CiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIGRvd25sb2FkRmlsZSgpIHsKICAgICAgICAgICAgbGV0IF90aGlzID0gdGhpcwogICAgICAgICAgICBpZiAoIV90aGlzLml0ZW0gJiYgKCFfdGhpcy5tdWx0aXBsZVNlbGVjdGlvbiB8fCBfdGhpcy5tdWx0aXBsZVNlbGVjdGlvbi5sZW5ndGggPT09IDApKSB7CiAgICAgICAgICAgICAgICBfdGhpcy4kbWVzc2FnZS5lcnJvcign6K+36YCJ5oup6KaB5LiL6L2955qE5paH5Lu2JykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghX3RoaXMuaXRlbSkgewogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlMZW5ndGggPSBfdGhpcy5tdWx0aXBsZVNlbGVjdGlvbi5sZW5ndGg7IGkgPCBpTGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMubXVsdGlwbGVTZWxlY3Rpb25baV0uZm9sZGVyRmxhZyA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy4kbWVzc2FnZS5lcnJvcign5paH5Lu25aS55pqC5LiN5pSv5oyB5LiL6L29JykKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgX3RoaXMuZG9Eb3duTG9hZHMoX3RoaXMubXVsdGlwbGVTZWxlY3Rpb24pCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKF90aGlzLml0ZW0pIHsKICAgICAgICAgICAgICAgIGlmIChfdGhpcy5pdGVtLmZvbGRlckZsYWcgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy4kbWVzc2FnZS5lcnJvcign5paH5Lu25aS55pqC5LiN5pSv5oyB5LiL6L29JykKICAgICAgICAgICAgICAgICAgICByZXR1cm4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIF90aGlzLmRvRG93bmxvYWQoX3RoaXMuaXRlbSkKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZG9Eb3dubG9hZChpdGVtKSB7CiAgICAgICAgICAgIGxldCB1cmwgPSBwYW5VdGlsLmdldFVybFByZWZpeCgpICsgJy9maWxlL2Rvd25sb2FkP2ZpbGVJZD0nICsgaXRlbS5maWxlSWQgKyAnJmF1dGhvcml6YXRpb249JyArIGdldFRva2VuKCksCiAgICAgICAgICAgICAgICBmaWxlbmFtZSA9IGl0ZW0uZmlsZW5hbWUsCiAgICAgICAgICAgICAgICBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpCiAgICAgICAgICAgIGxpbmsuc3R5bGUuZGlzcGxheSA9ICdub25lJwogICAgICAgICAgICBsaW5rLmhyZWYgPSB1cmwKICAgICAgICAgICAgbGluay5zZXRBdHRyaWJ1dGUoJ2Rvd25sb2FkJywgZmlsZW5hbWUpCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluaykKICAgICAgICAgICAgbGluay5jbGljaygpCiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGluaykKICAgICAgICB9LAogICAgICAgIGRvRG93bkxvYWRzKGl0ZW1zLCBpKSB7CiAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMKICAgICAgICAgICAgaWYgKCFpKSB7CiAgICAgICAgICAgICAgICBpID0gMAogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpdGVtcy5sZW5ndGggPT09IGkpIHsKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgX3RoaXMuZG9Eb3dubG9hZChpdGVtc1tpXSk7CiAgICAgICAgICAgICAgICBpKysKICAgICAgICAgICAgICAgIF90aGlzLmRvRG93bkxvYWRzKGl0ZW1zLCBpKQogICAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KICAgIH0sCiAgICBjb21wdXRlZDogewogICAgICAgIC4uLm1hcEdldHRlcnMoWydtdWx0aXBsZVNlbGVjdGlvbiddKQogICAgfSwKICAgIG1vdW50ZWQoKSB7CiAgICB9LAogICAgd2F0Y2g6IHt9Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;AAaA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/buttons/download-button","sourcesContent":["<template>\n    <div class=\"download-button-content\">\n        <el-button v-if=\"roundFlag\" type=\"info\" :size=\"size\" round @click=\"downloadFile\" :loading=\"loading\">\n            下载<i class=\"el-icon-download el-icon--right\"/>\n        </el-button>\n        <el-button v-if=\"circleFlag\" type=\"info\" :size=\"size\" circle @click=\"downloadFile\" :loading=\"loading\">\n            <i class=\"el-icon-download\"/>\n        </el-button>\n    </div>\n</template>\n\n<script>\n\n    import panUtil from '../../../utils/common'\n    import { getToken } from '../../../utils/cookie'\n    import { mapGetters } from 'vuex'\n\n    export default {\n        name: 'DownLoadButton',\n        components: {},\n        props: {\n            roundFlag: Boolean,\n            circleFlag: Boolean,\n            size: String,\n            item: Object\n        },\n        data() {\n            return {\n                loading: false\n            }\n        },\n        methods: {\n            downloadFile() {\n                let _this = this\n                if (!_this.item && (!_this.multipleSelection || _this.multipleSelection.length === 0)) {\n                    _this.$message.error('请选择要下载的文件')\n                    return\n                }\n                if (!_this.item) {\n                    for (let i = 0, iLength = _this.multipleSelection.length; i < iLength; i++) {\n                        if (_this.multipleSelection[i].folderFlag === 1) {\n                            _this.$message.error('文件夹暂不支持下载')\n                            return\n                        }\n                    }\n                    _this.doDownLoads(_this.multipleSelection)\n                }\n                if (_this.item) {\n                    if (_this.item.folderFlag === 1) {\n                        _this.$message.error('文件夹暂不支持下载')\n                        return\n                    }\n                    _this.doDownload(_this.item)\n                }\n            },\n            doDownload(item) {\n                let url = panUtil.getUrlPrefix() + '/file/download?fileId=' + item.fileId + '&authorization=' + getToken(),\n                    filename = item.filename,\n                    link = document.createElement('a')\n                link.style.display = 'none'\n                link.href = url\n                link.setAttribute('download', filename)\n                document.body.appendChild(link)\n                link.click()\n                document.body.removeChild(link)\n            },\n            doDownLoads(items, i) {\n                let _this = this\n                if (!i) {\n                    i = 0\n                }\n                if (items.length === i) {\n                    return\n                }\n                setTimeout(function () {\n                    _this.doDownload(items[i]);\n                    i++\n                    _this.doDownLoads(items, i)\n                }, 500);\n            }\n        },\n        computed: {\n            ...mapGetters(['multipleSelection'])\n        },\n        mounted() {\n        },\n        watch: {}\n    }\n</script>\n\n<style>\n\n    .download-button-content {\n        display: inline-block;\n        margin-right: 10px;\n    }\n\n</style>"]}]}