{"remainingRequest":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\src\\components\\buttons\\share-button\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\src\\components\\buttons\\share-button\\index.vue","mtime":1710063487724},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\software\\download\\r-pan-scaffolding-master\\r-pan-scaffolding-master\\r-pan-portal\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgc2hhcmVTZXJ2aWNlIGZyb20gJy4uLy4uLy4uL2FwaS9zaGFyZScKaW1wb3J0IHsgbWFwR2V0dGVycyB9IGZyb20gJ3Z1ZXgnCgpleHBvcnQgZGVmYXVsdCB7CiAgICBuYW1lOiAiU2hhcmVCdXR0b24iLAogICAgY29tcG9uZW50czoge30sCiAgICBwcm9wczogewogICAgICAgIHJvdW5kRmxhZzogQm9vbGVhbiwKICAgICAgICBjaXJjbGVGbGFnOiBCb29sZWFuLAogICAgICAgIHNpemU6IFN0cmluZywKICAgICAgICBpdGVtOiBPYmplY3QKICAgIH0sCiAgICBkYXRhKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHNoYXJlRGlhbG9nVmlzaWJsZTogZmFsc2UsCiAgICAgICAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICAgICAgICBzdGVwOiAxLAogICAgICAgICAgICBzaGFyZUZpbGVGb3JtOiB7CiAgICAgICAgICAgICAgICBzaGFyZU5hbWU6ICcnLAogICAgICAgICAgICAgICAgc2hhcmVUeXBlOiAnMCcsCiAgICAgICAgICAgICAgICBzaGFyZURheVR5cGU6ICcwJwogICAgICAgICAgICB9LAogICAgICAgICAgICBzaGFyZUZpbGVSdWxlczogewogICAgICAgICAgICAgICAgc2hhcmVOYW1lOiBbCiAgICAgICAgICAgICAgICAgICAge3JlcXVpcmVkOiB0cnVlLCBtZXNzYWdlOiAn6K+36L6T5YWl5YiG5Lqr5ZCN56ewJywgdHJpZ2dlcjogJ2JsdXInfQogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9LAogICAgICAgICAgICBzaGFyZVRpdGxlOiAnJywKICAgICAgICAgICAgc2hhcmVSZXN1bHRGb3JtOiB7CiAgICAgICAgICAgICAgICBzaGFyZVVybDogJycsCiAgICAgICAgICAgICAgICBzaGFyZUNvZGU6ICcnCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIHNoYXJlRmlsZSgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLml0ZW0gJiYgKCF0aGlzLm11bHRpcGxlU2VsZWN0aW9uIHx8IHRoaXMubXVsdGlwbGVTZWxlY3Rpb24ubGVuZ3RoID09PSAwKSkgewogICAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcign6K+36YCJ5oup6KaB5YiG5Lqr55qE5paH5Lu2JykKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLml0ZW0pIHsKICAgICAgICAgICAgICAgIHRoaXMuc2hhcmVUaXRsZSA9ICfliIbkuqvmlofku7bvvIgnICsgdGhpcy5oYW5kbGVGaWxlbmFtZSh0aGlzLml0ZW0uZmlsZW5hbWUpICsgJyknCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5tdWx0aXBsZVNlbGVjdGlvbi5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNoYXJlVGl0bGUgPSAn5YiG5Lqr5paH5Lu277yIJyArIHRoaXMuaGFuZGxlRmlsZW5hbWUodGhpcy5tdWx0aXBsZVNlbGVjdGlvblswXS5maWxlbmFtZSkgKyAnKScKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zaGFyZVRpdGxlID0gJ+WIhuS6q+aWh+S7tu+8iCcgKyB0aGlzLmhhbmRsZUZpbGVuYW1lKHRoaXMubXVsdGlwbGVTZWxlY3Rpb25bMF0uZmlsZW5hbWUpICsgJ+etiSknCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zaGFyZURpYWxvZ1Zpc2libGUgPSB0cnVlCiAgICAgICAgfSwKICAgICAgICBmb2N1c0lucHV0KHJlZk5hbWUpIHsKICAgICAgICAgICAgdGhpcy4kcmVmc1tyZWZOYW1lXS5mb2N1cygpCiAgICAgICAgfSwKICAgICAgICByZXNldEZvcm0ocmVmTmFtZSkgewogICAgICAgICAgICB0aGlzLiRyZWZzW3JlZk5hbWVdLnJlc2V0RmllbGRzKCkKICAgICAgICAgICAgdGhpcy5zdGVwID0gMQogICAgICAgICAgICB0aGlzLnNoYXJlVGl0bGUgPSAnJwogICAgICAgICAgICB0aGlzLnNoYXJlUmVzdWx0Rm9ybSA9IHsKICAgICAgICAgICAgICAgIHNoYXJlVXJsOiAnJywKICAgICAgICAgICAgICAgIHNoYXJlQ29kZTogJycKICAgICAgICAgICAgfQogICAgICAgIH0sCiAgICAgICAgZG9TaGFyZUZpbGUoKSB7CiAgICAgICAgICAgIGxldCBfdGhpcyA9IHRoaXMsCiAgICAgICAgICAgICAgICBzaGFyZUZpbGVJZEFyciA9IG5ldyBBcnJheSgpCiAgICAgICAgICAgIF90aGlzLmxvYWRpbmcgPSB0cnVlCiAgICAgICAgICAgIGlmIChfdGhpcy5pdGVtKSB7CiAgICAgICAgICAgICAgICBzaGFyZUZpbGVJZEFyci5wdXNoKF90aGlzLml0ZW0uZmlsZUlkKQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgX3RoaXMubXVsdGlwbGVTZWxlY3Rpb24uZm9yRWFjaChpdGVtID0+IHsKICAgICAgICAgICAgICAgICAgICBzaGFyZUZpbGVJZEFyci5wdXNoKGl0ZW0uZmlsZUlkKQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfQogICAgICAgICAgICBzaGFyZVNlcnZpY2UuY3JlYXRlU2hhcmUoewogICAgICAgICAgICAgICAgc2hhcmVOYW1lOiBfdGhpcy5zaGFyZUZpbGVGb3JtLnNoYXJlTmFtZSwKICAgICAgICAgICAgICAgIHNoYXJlVHlwZTogcGFyc2VJbnQoX3RoaXMuc2hhcmVGaWxlRm9ybS5zaGFyZVR5cGUpLAogICAgICAgICAgICAgICAgc2hhcmVEYXlUeXBlOiBwYXJzZUludChfdGhpcy5zaGFyZUZpbGVGb3JtLnNoYXJlRGF5VHlwZSksCiAgICAgICAgICAgICAgICBzaGFyZUZpbGVJZHM6IHNoYXJlRmlsZUlkQXJyLmpvaW4oJ19fLF9fJykKICAgICAgICAgICAgfSwgcmVzID0+IHsKICAgICAgICAgICAgICAgIF90aGlzLmxvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgX3RoaXMuc2hhcmVUaXRsZSA9ICfmga3llpzkvaDvvIHliIbkuqvmiJDlip/vvIEnCiAgICAgICAgICAgICAgICBfdGhpcy5zaGFyZVJlc3VsdEZvcm0uc2hhcmVVcmwgPSByZXMuZGF0YS5zaGFyZVVybAogICAgICAgICAgICAgICAgX3RoaXMuc2hhcmVSZXN1bHRGb3JtLnNoYXJlQ29kZSA9IHJlcy5kYXRhLnNoYXJlQ29kZQogICAgICAgICAgICAgICAgX3RoaXMuc3RlcCA9IDIKICAgICAgICAgICAgfSwgcmVzID0+IHsKICAgICAgICAgICAgICAgIF90aGlzLmxvYWRpbmcgPSBmYWxzZQogICAgICAgICAgICAgICAgX3RoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLm1lc3NhZ2UpCiAgICAgICAgICAgIH0pCiAgICAgICAgfSwKICAgICAgICBoYW5kbGVGaWxlbmFtZShmaWxlbmFtZSkgewogICAgICAgICAgICBpZiAoZmlsZW5hbWUubGVuZ3RoID4gMTApIHsKICAgICAgICAgICAgICAgIGZpbGVuYW1lID0gZmlsZW5hbWUuc3Vic3RyaW5nKDAsIDExKSArICcuLi4nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZpbGVuYW1lCiAgICAgICAgfSwKICAgICAgICBjb3B5KCkgewogICAgICAgICAgICBsZXQgc2hhcmVNZXNzYWdlID0gJ+mTvuaOpe+8micgKyB0aGlzLnNoYXJlUmVzdWx0Rm9ybS5zaGFyZVVybCArICdcbuaPkOWPluegge+8micgKyB0aGlzLnNoYXJlUmVzdWx0Rm9ybS5zaGFyZUNvZGUgKyAnXG7otbblv6vliIbkuqvnu5nlsI/kvJnkvLTlkKfvvIEnCiAgICAgICAgICAgIHRoaXMuJGNsaXBib2FyZChzaGFyZU1lc3NhZ2UpCiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygn5aSN5Yi25oiQ5YqfJykKICAgICAgICB9CiAgICB9LAogICAgY29tcHV0ZWQ6IHsKICAgICAgICAuLi5tYXBHZXR0ZXJzKFsnbXVsdGlwbGVTZWxlY3Rpb24nXSkKICAgIH0sCiAgICBtb3VudGVkKCkgewogICAgfSwKICAgIHdhdGNoOiB7fQp9Cg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/buttons/share-button","sourcesContent":["<template>\n    <div class=\"share-button-content\">\n        <el-button class=\"share-button\" v-if=\"roundFlag\" :size=\"size\" round @click=\"shareFile\">\n            分享<i class=\"el-icon-share el-icon--right\"/>\n        </el-button>\n        <el-button class=\"share-button\" v-if=\"circleFlag\" icon=\"el-icon-share\" :size=\"size\" circle @click=\"shareFile\">\n        </el-button>\n        <el-dialog\n                :title=\"shareTitle\"\n                :visible.sync=\"shareDialogVisible\"\n                @opened=\"focusInput('shareName')\"\n                @closed=\"resetForm('shareForm')\"\n                width=\"30%\"\n                :append-to-body=true\n                :modal-append-to-body=false\n                :center=true>\n            <div>\n                <div v-if=\"step === 1\">\n                    <el-form label-width=\"100px\" :rules=\"shareFileRules\" ref=\"shareForm\"\n                             :model=\"shareFileForm\"\n                             status-icon\n                             @submit.native.prevent>\n                        <el-form-item label=\"分享名称\" prop=\"shareName\">\n                            <el-input type=\"text\"\n                                      ref=\"shareName\"\n                                      v-model=\"shareFileForm.shareName\" autocomplete=\"off\"/>\n                        </el-form-item>\n                        <el-form-item label=\"分享类型\">\n                            <el-radio-group v-model=\"shareFileForm.shareType\">\n                                <el-radio disabled label=\"0\">有提取码</el-radio>\n                            </el-radio-group>\n                        </el-form-item>\n                        <el-form-item label=\"分享有效期\">\n                            <el-select v-model=\"shareFileForm.shareDayType\">\n                                <el-option label=\"永久有效\" value=\"0\"></el-option>\n                                <el-option label=\"7天有效\" value=\"1\"></el-option>\n                                <el-option label=\"30天有效\" value=\"2\"></el-option>\n                            </el-select>\n                        </el-form-item>\n                    </el-form>\n                </div>\n                <div v-if=\"step === 2\">\n                    <el-form label-width=\"100px\"\n                             status-icon\n                             @submit.native.prevent>\n                        <el-form-item label=\"分享链接\" prop=\"shareUrl\">\n                            <el-link :underline=false type=\"primary\"><span>{{ shareResultForm.shareUrl }}</span>\n                            </el-link>\n                        </el-form-item>\n                        <el-form-item label=\"提取码\">\n                            <el-link :underline=false type=\"success\"><span>{{ shareResultForm.shareCode }}</span>\n                            </el-link>\n                        </el-form-item>\n                        <div class=\"share-result-button-content\">\n                            <el-button type=\"primary\" class=\"share-result-copy-button\" @click=\"copy\">\n                                点击复制<i class=\"el-icon-document-copy el-icon--right\"></i>\n                            </el-button>\n                        </div>\n                    </el-form>\n                </div>\n            </div>\n            <span v-if=\"step === 1\" slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"shareDialogVisible = false\">取 消</el-button>\n                <el-button type=\"primary\" @click=\"doShareFile\" :loading=\"loading\">确 定</el-button>\n            </span>\n        </el-dialog>\n    </div>\n</template>\n\n<script>\n\n    import shareService from '../../../api/share'\n    import { mapGetters } from 'vuex'\n\n    export default {\n        name: \"ShareButton\",\n        components: {},\n        props: {\n            roundFlag: Boolean,\n            circleFlag: Boolean,\n            size: String,\n            item: Object\n        },\n        data() {\n            return {\n                shareDialogVisible: false,\n                loading: false,\n                step: 1,\n                shareFileForm: {\n                    shareName: '',\n                    shareType: '0',\n                    shareDayType: '0'\n                },\n                shareFileRules: {\n                    shareName: [\n                        {required: true, message: '请输入分享名称', trigger: 'blur'}\n                    ]\n                },\n                shareTitle: '',\n                shareResultForm: {\n                    shareUrl: '',\n                    shareCode: ''\n                }\n            }\n        },\n        methods: {\n            shareFile() {\n                if (!this.item && (!this.multipleSelection || this.multipleSelection.length === 0)) {\n                    this.$message.error('请选择要分享的文件')\n                    return\n                }\n                if (this.item) {\n                    this.shareTitle = '分享文件（' + this.handleFilename(this.item.filename) + ')'\n                } else {\n                    if (this.multipleSelection.length === 1) {\n                        this.shareTitle = '分享文件（' + this.handleFilename(this.multipleSelection[0].filename) + ')'\n                    } else {\n                        this.shareTitle = '分享文件（' + this.handleFilename(this.multipleSelection[0].filename) + '等)'\n                    }\n                }\n                this.shareDialogVisible = true\n            },\n            focusInput(refName) {\n                this.$refs[refName].focus()\n            },\n            resetForm(refName) {\n                this.$refs[refName].resetFields()\n                this.step = 1\n                this.shareTitle = ''\n                this.shareResultForm = {\n                    shareUrl: '',\n                    shareCode: ''\n                }\n            },\n            doShareFile() {\n                let _this = this,\n                    shareFileIdArr = new Array()\n                _this.loading = true\n                if (_this.item) {\n                    shareFileIdArr.push(_this.item.fileId)\n                } else {\n                    _this.multipleSelection.forEach(item => {\n                        shareFileIdArr.push(item.fileId)\n                    })\n                }\n                shareService.createShare({\n                    shareName: _this.shareFileForm.shareName,\n                    shareType: parseInt(_this.shareFileForm.shareType),\n                    shareDayType: parseInt(_this.shareFileForm.shareDayType),\n                    shareFileIds: shareFileIdArr.join('__,__')\n                }, res => {\n                    _this.loading = false\n                    _this.shareTitle = '恭喜你！分享成功！'\n                    _this.shareResultForm.shareUrl = res.data.shareUrl\n                    _this.shareResultForm.shareCode = res.data.shareCode\n                    _this.step = 2\n                }, res => {\n                    _this.loading = false\n                    _this.$message.error(res.message)\n                })\n            },\n            handleFilename(filename) {\n                if (filename.length > 10) {\n                    filename = filename.substring(0, 11) + '...'\n                }\n                return filename\n            },\n            copy() {\n                let shareMessage = '链接：' + this.shareResultForm.shareUrl + '\\n提取码：' + this.shareResultForm.shareCode + '\\n赶快分享给小伙伴吧！'\n                this.$clipboard(shareMessage)\n                this.$message.success('复制成功')\n            }\n        },\n        computed: {\n            ...mapGetters(['multipleSelection'])\n        },\n        mounted() {\n        },\n        watch: {}\n    }\n</script>\n\n<style>\n\n    .share-button-content {\n        display: inline-block;\n        margin-right: 10px;\n    }\n\n    .share-button-content .share-button {\n        background-color: #F2F6FC;\n    }\n\n    .share-result-button-content {\n        width: 100%;\n        height: 10px;\n        line-height: 30px;\n        text-align: right;\n        padding: 0 10px 20px 0;\n    }\n\n</style>"]}]}